1- Chargement du fichier de la SCE
a exécuter en ligne de commande MSDOS

sqlldr delta23/nfc@delta control = x:\load\traiteSce02.ctl data=X:\Files\Recup_Impayes_07_2017.txt log = x:\files\Recup_Impayes_07_2017.log bad= x:\files\Recup_Impayes_07_2017.bad;

2- Importation des soldes et statuts des comptes dans flexcube
 - vidage de la table des positions
   
   truncate table positions;
 - Insertion des informations sur les comptes à partir de flexcube
 exécution en ligne de commande sql en tant que sysdba
 
copy  from nfcread/nfcread1@fcubs to delta23/nfc@delta insert  positions using SELECT DISTINCT a.cust_ac_no POS_UBS_ACCOUNT , a.lcy_curr_balance + nvl(a.tod_limit,0) POS_BALANCE, a.ac_stat_dormant POS_STATUS_DORMANT, a.ac_stat_no_dr POS_NO_DEBIT,a.record_stat POS_RECORD_STAT, a.dormancy_date POS_DORMANCY_DATE FROM xafnfc.sttms_cust_account a WHERE substr(a.account_class,1,2) ='28';

3- Mise à jour de la table de chargement des traite sce

update traite_sce set sce_salary = 
(
 select nvl(fon_montant_mois_actuel,0) from paie_fonctionnaire where fon_matricule = sce_matricule
)
where sce_date_traite = '&Date_Paie';


update traite_sce set sce_position = 
(
 select nvl(pos_balance,0) from positions where pos_ubs_account = sce_fcubs_account
)
where sce_date_traite = '&Date_Paie';

update traite_sce set sce_dormancy = 
(
 select pos_status_dormant from positions where pos_ubs_account = sce_fcubs_account
)
where sce_date_traite = '&Date_Paie';

update traite_sce set sce_no_debit = 
(
 select pos_no_debit from positions where pos_ubs_account = sce_fcubs_account
)
where sce_date_traite = '&Date_Paie';

update traite_sce set sce_record_stat = 
(
 select pos_record_stat from positions where pos_ubs_account = sce_fcubs_account
)
where sce_date_traite = '&Date_Paie';

commit;

4- Génération des Fichiers de Chargement
à exécuter en ligne de commande sql dans plsql
 - batch_no ='9999'
 - date_paie ='22-MON-RRRR'
Execute sce_upload_files(&P_BATCH_NO,&P_DATE_PAIE);


5- Vérification des équilibres

6 - Chargement dans Flexcube


