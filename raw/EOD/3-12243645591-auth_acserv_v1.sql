SET HEAD ON
SET ARRAY 1
SET LINESIZE 10000
SET PAGESIZE 50000
SET LONG 10000
SET ECHO ON
SET TRIMSPOOL ON
SET COLSEP ';'
SET NUMFORMAT 9999999999999999.9999
SPOOL  C:\3-12243645591-AUTH_ACSERV-V1.SPL


select TRN_REF_NO,EVENT_SR_NO,AC_CCY,AC_BRANCH,USER_ID
		from actbs_daily_log where trn_ref_no IN ('0101602160560143',
'0101602160560145',
'0101602160560148',
'0101602160560141',
'0101602160560144',
'0101602160560146',
'0101602160560142',
'0101602160560147');

--CHANGE THE TRN_REF_NO AND EVENT_SEQ_NO before sending
DECLARE

	CURSOR CUR_ACC IS
		select TRN_REF_NO,EVENT_SR_NO,AC_CCY,AC_BRANCH,USER_ID
		from actbs_daily_log where auth_stat = 'U' AND trn_ref_no IN ('0101602160560143',
'0101602160560145',
'0101602160560148',
'0101602160560141',
'0101602160560144',
'0101602160560146',
'0101602160560142',
'0101602160560147');
			
	PERRCODE 	VARCHAR2(100);
	PPARAM 	VARCHAR2(1000);

	I 		NUMBER ;

BEGIN

	
        i := 0 ;
	FOR C1 IN CUR_ACC LOOP
		
		GLOBAL.PR_INIT(C1.AC_BRANCH,'SYSTEM');
		
		IF ACPKSS.fn_acservice
   			(
			C1.AC_BRANCH ,
			global.application_date,
			global.lcy    ,
			C1.trn_ref_no ,
			C1.event_sr_no ,
			'A' ,
			'SYSTEM' , -- Change the user id
			pErrCodE,
			pParam	
		   	) THEN
			    DEBUG.PR_DEBUG('AC','SUCCESS - '||C1.trn_ref_no);
		ELSE
		    DEBUG.PR_DEBUG('AC','ERROR - '||C1.trn_ref_no || SQLERRM);
		END IF;

		I:=I+1;

		DEBUG.PR_DEBUG('AC','FINAL COUNT'||I);

	END LOOP;

	COMMIT;
EXCEPTION
	WHEN OTHERS
	THEN debug.pr_debug('AC','WOT - ' || SQLERRM);
	ROLLBACK;

END;
/

select TRN_REF_NO,EVENT_SR_NO,AC_CCY,AC_BRANCH,USER_ID
		from actbs_daily_log where trn_ref_no IN ('0101602160560143',
'0101602160560145',
'0101602160560148',
'0101602160560141',
'0101602160560144',
'0101602160560146',
'0101602160560142',
'0101602160560147');
		

SPOOL OFF;